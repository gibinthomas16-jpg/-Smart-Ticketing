from flask import Flask, request, jsonify
from pricing import smart_price
from fraud_detection import fraud_check

app = Flask(__name__)

# Sample event data
events = {
    1: {"name": "Concert", "base_price": 1000, "tickets_left": 300}
}

@app.route("/book", methods=["POST"])
def book_ticket():
    data = request.json
    event = events[data["event_id"]]

    # Fraud check
    if fraud_check(data["tickets"]):
        return jsonify({"status": "Blocked", "reason": "Suspicious booking"}), 403

    # Smart pricing
    price = smart_price(event["base_price"], event["tickets_left"])
    event["tickets_left"] -= data["tickets"]

    return jsonify({
        "status": "Success",
        "price_per_ticket": price,
        "total_price": price * data["tickets"]
    })

if __name__ == "__main__":
    app.run(debug=True)

